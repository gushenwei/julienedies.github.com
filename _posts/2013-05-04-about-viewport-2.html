---
layout: post
title: "关于viewport 2"
description: ""
category: 翻译
tags: [viewport, mobile, english]
---
{% include JB/setup %}

<p>
    英语原文：<a href="http://www.quirksmode.org/mobile/viewports.html">www.quirksmode.org/mobile/viewports.html</a>
</p>
<code>
    meta name="viewport" content="width=drive-width,target-densitydpi=device-dpi, user-scalable=no" 
</code>

<h2>两个viewport的问题之二</h2>
<p>在这页我们将讨论移动浏览器。如果你对移动浏览器完全没有了解。建议你先阅读本文的<a href="/2013/05/03/about-viewport-1/" >第一部分</a>，熟悉相关背景。</p>

<section>
	<h3>移动浏览器的问题</h3>
	<p>当我们比较桌面浏览器和移动浏览器，最明显的区别是屏幕大小。对于优化过的site，移动浏览器显示的明显比桌面浏览器少。通过缩放直到文本调整到合适的大小，或者只显示处在屏幕上的一小部分。</p>
	<p>相较于桌面屏幕，移动设备屏幕非常小。想想最大才400px宽，有时甚至更小。</p>
	<p>一些平板电脑如iPad的尺寸则介于桌面屏幕和手机屏幕之间，但这并不改变基本问题。sites也要能够在移动设备上工作，所以我们必须让它们很好的显示在小屏幕上。</p>
	<p>最重要的问题集中在css上，尤其是viewport的尺寸。如果我们只单纯的移植桌面浏览器开发模式，我们会死的很难看。</p>
	<p>让我们回想之前提到的10% width的列。如果移动浏览器和桌面浏览器行为完全一样，列最宽为40px，毫无疑问，这太窄了。你的流布局完蛋了。</p>
	<p>解决这个问题的方法之一是为移动浏览器开发专门的site，即使撇去是否应该这样做的原则问题，实际的问题是只有很少的站点能够完成这个任务。</p>
	<p>移动浏览器提供商为这个问题提供了自己的解决方案：“使移动浏览器尽可能地像桌面浏览器”。这需要一些巧妙的手段。</p>
</section>

<section>
	<h3>两个viewport</h3>
	<p>既然问题的基础是对于css布局，viewport太窄，那最明显的解决方案就是使viewport变宽。这样，viewport分离成两个：可视视口(visual viewport)和布局视口(layout viewport)。</p>
	<p>以下是George Cummins做的基本概念阐释：<a href="http://stackoverflow.com/questions/6333927/difference-between-visual-viewport-and-layout-viewport">原文链接</a></p>
	<blockquote>
		Imagine the layout viewport as being a large image which does not change size or shape. Now image you have a smaller frame through which you look at the large image. The small frame is surrounded by opaque material which obscures your view of all but a portion of the large image. The portion of the large image that you can see through the frame is the visual viewport. You can back away from the large image while holding your frame (zoom out) to see the entire image at once, or you can move closer (zoom in) to see only a portion. You can also change the orientation of the frame, but the size and shape of the large image (layout viewport) never changes.
	</blockquote>
<p>See also <a href="http://stackoverflow.com/questions/7344886/visual-viewport-vs-layout-viewport-on-mobile-devices" class="external">this explanation</a> by Chris.</p>	
	<p><strong>visual viewport</strong>是当前显示在屏幕上的页面部分。用户能够滚动页面去改变页面可视部分，或者通过缩放改变visual viewport的大小。</p>
	<p><img src="/assets/img/viewport/mobile_visualviewport.jpg" /></p>
	<p>然而，css布局，尤其是100%宽将会相对于<strong>Layout viewport</strong>进行计算，这当然比visual viewport宽。 </p>
	<p>这样<code>html</code>元素初始化为Layout viewport的宽，并且css好像好像工作在比phone屏幕宽的多的屏幕上。这样就保证了你的site css布局像在桌面浏览器上一样。</p>
	<p>Layout viewport是多宽呢？每个浏览器都不同。Safari iPhone为980px，Opera为850px，Android WebKit为800px,IE为974px。</p>
	<p>一些浏览器有特别的行为：</p>
	<ul class="smaller">
	<li>Symbian WebKit tries to keep the layout viewport equal to the visual viewport,
	and yes, that means that elements with a percentual width may behave oddly. However,
	if the page doesn’t fit into the visual viewport due to absolute widths the browser stretches up the layout viewport to a
	maximum of 850px.</li>
	<li>Samsung WebKit (on bada) makes the layout viewport as wide as the widest element.</li>
	<li>On BlackBerry the layout viewport equals the visual viewport at 100% zoom. This
	does not change.</li>
</ul>
	<h4>Zomming</h4>
	<p>很明显，两个viewport都是以css像素进行计算。但是当visual viewport的尺寸随着缩放产生变化，（如果你放大，屏幕上的css像素数量会减少），layout viewport保持不变。如果不这样，页面布局会不断重绘，像100%宽重新被计算那样。</p>
	<h4>理解Layout viewport</h4>
	<p>为了理解Layout viewport的大小，我们需要看看当页面处在fully zoomed out 模式中时发生了什么？大部分浏览器以zoomed out模式初始显示页面。</p>
	<p>关键在于： browsers have chosen their dimensions of the layout viewport such that it completely covers the screen in fully zoomed-out mode (这样的话就等于visual viewport).</p>
	<p><img src="/assets/img/viewport/mobile_viewportzoomedout.jpg" /></p>
	<p>layout viewport的宽高总是等于Thus the width and the height of the layout viewport are equal to whatever can be shown on the screen in the maximally zoomed-out mode. When the user zooms in these dimensions stay the same.</p>
	<p><img src="/assets/img/viewport/mobile_layoutviewport.jpg" /></p>
	<p>layout viewport的宽总是不变。如果你旋转手机，visual viewport改变，但是浏览器通过轻微的缩放适配新的方向。因此layout viewport还是和visual viewport一样宽。</p>
	<p><img src="/assets/img/viewport/mobile_viewportzoomedout_la.jpg" /></p>
	<p>这里有一个影响，大体上layout viewport的height比纵向时减小了。但这不重要，重要的是width。</p>
	<p><img src="/assets/img/viewport/mobile_layoutviewport_la.jpg" /></p>
</section>

<section>
	<h3>Measuring layout viewport</h3>
	<div class="floater">
<h5 id="link6">document. documentElement. clientWidth/Height</h5>
<dl class="data">
<dt>Meaning</dt><dd>Layout viewport dimensions</dd>
<dt>Measured in</dt><dd>CSS pixels</dd>
<dt>Full support</dt><dd>Opera, iPhone, Android, Symbian, Bolt, MicroB, Skyfire, Obigo</dd>
<dt>Problems</dt><dd>Visual viewport dimensions in Iris</dd>
<dd>Samsung WebKit reports the correct values when a <code>&lt;meta viewport&gt;</code> tag is applied to the page; the dimensions of the <code>&lt;html&gt;</code> element otherwise.</dd>
<dd>Screen dimensions in device pixels in Firefox</dd>
<dd>IE returns 1024x768. However, it stores the information in <code>document.<strong>body</strong>.clientWidth/Height</code>.
This is consistent with IE6 desktop.</dd>
<dd>NetFront’s values are only correct at 100% zoom.</dd>
<dd>Symbian WebKit 1 (older S60v3 devices) does not support these properties.</dd>
<dt>Not supported</dt><dd>BlackBerry</dd>
</dl>
<p>现在我们有两个viewport需要计算，运气不错，浏览器提供了两个属性：</p>
<p><code>document.documentElement.clientWidth/clientHeight</code>包含了layout viewport的宽高值。</p>
<p><img src="/assets/img/viewport/mobile_client.jpg" /></p>
<p>横向或纵向对height重要，但对width不重要。</p>
<p><img src="/assets/img/viewport/mobile_client_la.jpg" /></p>
</div>
</section>

<section>
	<h3>Measuring visual viewport</h3>
	<div class="floater">
<h5 id="link8">window.innerWidth/Height</h5>
<dl class="data">
<dt>Meaning</dt><dd>Visual viewport dimensions</dd>
<dt>Measured in</dt><dd>CSS pixels</dd>
<dt>Full support</dt><dd>iPhone, Symbian, BlackBerry</dd>
<dt>Problems</dt><dd>Opera and Firefox return the screen width in device pixels.</dd>
<dd>Android, Bolt, MicroB, and NetFront return the layout viewport dimensions in CSS pixels.</dd>
<dt>Not supported</dt><dd>IE,  but it gives the visual viewport dimension in <code>document.
documentElement. offsetWidth/Height</code>.</dd>
<dd>Samsung WebKit reports either the dimensions of the layout viewport or of the <code>&lt;html&gt;</code>, depending on whether a <code>&lt;meta viewport&gt;</code> tag has been applied to the page or not.</dd>
<dt>Gibberish</dt><dd>Iris, Skyfire, Obigo</dd>
</dl>
</div>
	<p>接下来是visual viewport，可以通过<code>window.innerWidth/innerHeight</code>取得其值。很明显当用户缩放的时候，其值会改变，因为更多或更少的css像素显示在屏幕上。</p>
	<p><img src="/assets/img/viewport/mobile_inner.jpg" /></p>
	<p>不幸的是：兼容性不是很好；许多浏览器仍然需要添加对visual viewport尺寸计算的支持。没有浏览器提供其它属性用以获取该值，因此我猜<code>window.innerWidth/innerHeight</code>是一个标准。albeit a badly supported one。</p>
</section>

<section>
	<h3>The Screen</h3>
	<div class="floater">
<h5 id="link10">screen.width and screen.height</h5>
<dl class="data">
<dt>Meaning</dt><dd>Screen size</dd>
<dt>Measured in</dt><dd>Device pixels</dd>
<dt>Full support</dt><dd>Opera Mini, Android, Symbian, Iris, Firefox, MicroB, IE, BlackBerry</dd>
<dt>Problems</dt><dd>Opera Mobile on Windows Mobile only gives the landscape size.
Opera Mobile on S60 gets it right.</dd>
<dd>Samsung WebKit reports either the dimensions of the layout viewport or of the <code>&lt;html&gt;</code>, depending on whether a <code>&lt;meta viewport&gt;</code> tag has been applied to the page or not.</dd>
<dd>iPhone and Obigo only give portrait sizes.</dd>
<dd>NetFront only gives landscape sizes.</dd>
<dt>Gibberish</dt><dd>Bolt, Skyfire</dd>
</dl>
</div>
	<p>像桌面浏览器一样，<code>screen.Width/Height</code>获取屏幕大小，使用设备像素。也想桌面开发一样，基本上不需要这个信息。你不需要关心设备的物理尺寸大小，而是屏幕上的css像素多少。</p>
	<p><img src="/assets/img/viewport/mobile_screen.jpg" /></p>
	<h4>The zoom level</h4>
	<p>无法直接获取缩放级别，但是你可以通过相除<code>screen.Width</code>和<code>window.innerWidth</code>得到，如果所有属性都被完美支持的话。</p>
	<p>不过缩放级别不重要，你需要知道的是当前屏幕上有多少css像素，而且你可以通过<code>window.innerWidth</code>获取，如果它被正确的支持。</p>
</section>













