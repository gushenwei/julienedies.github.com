<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>可视化</title>
<link href="assets/style.css" rel="stylesheet" type="text/css" media="all" />
<script src="assets/d3.min.js"></script>
<script src="assets/jquery.min.js" type="text/javascript"></script>
<script src="assets/template.js" type="text/javascript"></script>
<script src="assets/33.js" type="text/javascript"></script>
<script src="assets/help.js" type="text/javascript"></script>
<script src="assets/doc.js" type="text/javascript"></script>
<script src="assets/init.js" type="text/javascript"></script>
<style>
aside{
	position:fixed;
	width:64px;
	height:100%;
	background:#dfe3e8;
}
aside button{
	position:absolute;
	left:5px;
	font-size:0.6em;
}
aside button.current{
	font-size:0.9em;
	font-weight:bold;
}
button[data-type="upMarginRef"]{
	top:40px;
}
button[data-type="downMarginRef"]{
	top:80px;
}
button[data-type="singleDigitRef"]{
	top:120px;
}

/* */
.title i,
.content em {
	position: absolute;
	top:0;
	left:0;
	width: 40px;
	height: 20px;
	line-height: 20px;
	text-align: center;
	color: #fff;
	background-color: #0070c0;
}

.title i {
	height: 20px;
	line-height: 20px;	
	font-style: normal;
	background-color: #538927;
}
.content em.red{
	background-color:#c00000;	
}
.title,
.content{
	left:64px;
	right:0;
	background: url(assets/img/bg3.png) repeat 0 0;	
}

.title {
	position: fixed;
	top: 0;
	z-index:100000;
	height:20px;
	overflow: hidden;
}

.content {
	position:absolute;
	top:20px;
	min-height: 1400px;
}

.content p {
	position: absolute;
	top:0;
}
</style>
</head>
<body>
<aside>
<button data-type="upMarginRef">上间隔</button>
<button data-type="downMarginRef">下间隔</button>
<button data-type="singleDigitRef">数尾</button>
</aside>
<div class="container">
<div class="title"></div>
<div class="content"></div>
</div>

<script>
	var view = function(data) {
		
		var m = 40;
		var h = 20;
		
		//////////////////////////////////////////////////
		var i = d3.select('.title').selectAll('i')
		.data(d3.range(0, 36));
		
		i.enter()
		.append('i');
		
		i.text(function(d) {
					return d;
				})
		.style('left', function(d) {
					return (d) * m + (d + 1) * 1 + 'px';
				});

		
		//////////////////////////////////////////////////
		var p = d3.select(".content").selectAll("p")
		.data(data);
		
		p.enter()
		.append("p");
		
		p.style('top', function(d, i) {
			return i * h + (i + 1) * 1 + 'px';
		});

		p.exit().remove();
		
		//////////////////////////////////////////////////
		var em = p.selectAll('em')
		.data(function(d) {
			return d;
		});
		
		em.enter().append("em");
		
		em.text(function(d) {
			return d[0];
		})
		.transition().duration(500)
		.style('left', function(d) {
			return d[0] * m + (d[0]*1 + 1) * 1 + 'px';
		});
		
		em.each(function(d,i){
			if(d[1] > 1){
				this.classList.add('red');
			}else{
				this.classList.remove('red');
			}
		});
		
		em.exit().remove();
	};
	
	
	
	////////////////////////////////////////////
	//init
	
	$('aside button').click(function(){
		var th = $(this);
		var type = th.attr('data-type');
		var data = window[type].slice(-28);
		
		th.addClass('current');
		th.siblings().removeClass('current');
		
		$('title').text('可视化'+type);
		
		$.each(data,function(i,v){
			data[i] = getArrUniqueSize(v);
		});
		view(data);		
	});
	
	

	var type = getUrlParam('type') || 'upMarginRef';
	var push = getUrlParam('push');

	var data = window[type].slice(-28);
	
	if(push){
		data.push(JSON.parse(push));
	}
	
	$.each(data,function(i,v){
		data[i] = getArrUniqueSize(v);
	});	

	view(data);
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</script>
</body>
</html>
